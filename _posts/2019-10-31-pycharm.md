---
layout: post
title: "My coding setup"
date: 2019-10-31 00:00:00 -0800
---
## Introduction

As a machine-learning researcher, I spend a lot of time writing Python. In grad school, I worked mostly in [Atom](https://atom.io) and [Jupyter](https://jupyter.org). I would prototype code and visualize results in notebooks while developing core code in Atom. While Atom has some useful features (syntax highlighting, autocomplete) for Python programming, it's not as full-featured as an integrated development environment (IDE). At VL56, I was introduced to [PyCharm](https://www.jetbrains.com/pycharm/) as a Python IDE, and I've gradually found a set-up that fits my needs and workflow. 

## What I want

This set-up is geared towards ML/computational biology research. On a daily basis, I 

- Run code interactively to figure out how to do something or to visualize results. 
- Train models on remote (AWS) machines with GPUs or much more compute/memory than is available locally. 
- Contribute to custom, version-controlled libraries that are shared across people and projects. 

As a result, I need to be able to 

- Sync code and results between my local machine and one or more remote machines. 
- Work interactively in Python on a remote machine, but with code completion. 
- Be able to disconnect my local computer during long training runs without losing progress. 

In order to accomplish these things, I set up SSH config files to make it easy to get into my remote instances, set up a remote interpreter and automatic file-syncing in PyCharm, and use Tmux for long-running jobs. 

I assume here that you already have one or more remote instances set up with static IP addresses. I've always used AWS EC2 instances for remote compute, but obviously other options exist. 

## Setting up an SSH config
Typically, if we have a remote instance with IP `a.b.c.d` and a private key `path/to/mykey.pem`, we access it via the command `$ ssh -i path/to/mykey.pem user@a.b.c.d`. We can set up an OpenSSH config to avoid having to remember our keys and IP addresses. This config should go in `~/.ssh/config`. Each stanza (entry) looks like

```
Host kky-p3
  Hostname a.b.c.d
  IdentityFile path/to/mykey.pem
  User ubuntu
```

Stanzas start with the `Host` directive and contain SSH arguments. Other arguments are possible, but these are the ones necessarily for the current usecase. Now, I can just use the host-name I've defined in the config to connect to this instance: `$ ssh kky-p3`. 

A more detailed explanation of SSH configs and why you should use them can be found [here](https://medium.com/tarkalabs/ssh-simplified-using-ssh-config-161406ba75d7).

## Setting a remote interpreter in PyCharm

1. Open the project for which you want a remote interpreter. Open preferences by hitting `⌘,`. 
2. On the left side of the preference pane, select `Project: project-name → Project Interpreter`.
3. Click the wheel in the top right and select `Add`.  
![steps 2 and 3]({{ site.baseurl }}/assets/pycharm23.png)

4.  On the left side, select `SSH Interpreter` and then fill out the `Host` and `Username` fields.  
![step 4]({{ site.baseurl }}/assets/pycharm4.png)
5. Use the Folder icons to fill out the paths to the Python binary and the remote location where your project files should sync.  
![step 5]({{ site.baseurl }}/assets/pycharm5.png)

Now, when you start a new Python Console within the project, it should run on your remote instance in the environment you specified. 

![Python console]({{ site.baseurl }}/assets/pycharm_console.png)

I used to do my prototyping in a Jupyter notebook, but nowadays I do most of it in the Python console within PyCharm. Sometimes I type directly into the console, but if I'm doing anything that requires more than 2 lines or so, I usually type it in the editor (often in the file I'm developing) and then use `⌥ shift E` to send my code to the console. That command either sends all the highlighted code (with smart unindenting!), or, if no code is highlighted, then the current line. 

## Syncing files


SCP = sad
Automatically set up 
Can set up more remotes
<pictures for setting up more remotes>
Automatic or manual
Can also download
## tmux for long-running jobs
Don't want training to die when ssh breaks
Tmux commands: new session, attach/detach, split window, close window, scroll up

## Acknowledgments

Almost everything I know about PyCharm I learned from [Andy Beam](http://beamlab.org/). 